@{
    var usuario = Session["usuarioLogeado"];
    var tipoCuenta = Session["tipoCuenta"];
    var idCuenta = Session["idCuenta"];
    var id = Session["id"];
    var fotoUsuario = Session["foto"];
    var rutaParcial = fotoUsuario.ToString().Split('\\')[fotoUsuario.ToString().Split('\\').Length - 1];
    var titulo = "";
    if (Convert.ToInt32(tipoCuenta) == 2)
    {
        titulo = "Reseñas del arrendador";
    }
    else
    {
        titulo = "Reseñas del arrendatario";
    }
}

<head>
    <meta name="viewport" content="width=device-width" />
    <title>Alquiler</title>
</head>
<style>
    .rating {
        display: flex;
        flex-direction: row-reverse;
        justify-content: left;
    }

        .rating > input {
            display: none
        }

        .rating > label {
            position: relative;
            width: 1em;
            font-size: 30px;
            color: #2c302dab;
            cursor: pointer
        }

            .rating > label::before {
                content: "\2605";
                position: absolute;
                opacity: 0
            }

            .rating > label:hover:before,
            .rating > label:hover ~ label:before {
                opacity: 1 !important
            }

        .rating > input:checked ~ label:before {
            opacity: 1
        }

        .rating:hover > input:checked ~ label:before {
            opacity: 0.4
        }

    h1,
    h1 {
        margin-top: 150px
    }

    p {
        font-size: 1.2rem
    }
</style>
<div class="modal fade" id="modalinmueble" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="min-width:800px; max-width:1000px;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel" style="color: #198754"><b>Reseñas del Inmueble</b></h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container" id="bodyModalInmueble">
                    @*Aca va todo el cuerpo*@
                </div>
            </div>
            <div class="modal-footer">
                <a href="" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Aceptar</a>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalarrendador" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="min-width:800px; max-width:1000px;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel" style="color: #198754"><b>@titulo</b></h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="row">
                <div class="col-3">
                    <h6 for="fechaDesdeInput">Fecha Desde</h6>
                    <br />
                    <input type="date" class="form-control" id="fechaDesdeFiltro" name="fechaDesdeInput" required>
                </div>
                <div class="col-3">
                    <h6 for="fechaDesdeInput">Fecha Hasta</h6>
                    <br />
                    <input type="date" class="form-control" id="fechaHastaFiltro" name="fechaDesdeInput" required>
                </div>
                <div class="col-1">
                    <button class="btn" onclick="obtres()">Filtrar</button>
                </div>
                
            </div>
            <div class="modal-body">
                <div class="container" id="bodyModalArrendador">
                    @*Aca va todo el cuerpo*@
                </div>
            </div>
            <div class="modal-footer">
                <a href="" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Aceptar</a>
                <button class="btn btn-success" onclick="imprimirReporteArrendador()">Imprimir Reporte</button>
            </div>
        </div>
    </div>
</div>
<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-info">
                        <div class="float-left">
                            <div class="titulo">Alquiler</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="container">
                                <div class="row">
                                    @*Inmueble*@
                                    <div class="container" id="Inmueble">

                                    </div>
                                    <div class="container" id="body">
                                        @*Aca va todo el cuerpo*@
                                    </div>
                                    <div class="container" id="bodyInmueble">
                                        @*Aca va todo el cuerpo*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/Generales.js"></script>
<script>
    
    var tipoCuenta = parseInt(@tipoCuenta);
    var idCuenta = parseInt(@idCuenta);
    var id = parseInt(@id);
    var pag = 1;
    var idAlquiler = parseInt(GetUrlVars()["idAlquiler"]);
    var esAoAr = false;
    var esArAo = false;
    var esAI = false;
    var idInmueble;
    var rutaParcial = "@rutaParcial";
    var nombreArr;
    var nombreArio;
    var fechaDesde;
    var fechaHasta;
    var fechaDesdeI;
    var fechaHastaIs;
    var tipoCuentaAo;
    var idAo;
    function imprimirReporteArrendador() {
        fechaDesde = $("#fechaDesdeFiltro").val();
        fechaHasta = $("#fechaHastaFiltro").val();
        window.open("/Reportes/ReporteResenias?tipoCuenta=" + tipoCuentaAo + "&id=" + idAo + "&fechaDesde=" + fechaDesde + "&fechaHasta=" + fechaHasta, "Reporte de Reseñas");
    }


    (function () {

        if (tipoCuenta == 2) {
            esArAo = true;
            esAI = true;
        }
        if (tipoCuenta == 3) {
            esAoAr = true;
        }

        completarDatos();
        completarResenias();
        if (tipoCuenta == 2) {
            completarReseniasInmueble();
        }
        /*cargarItems();*/
    })();
    function completarDatos() {
        $.ajax({
            type: 'Get',
            url: '/Api/Alquiler/ObtenerAlquiler?idAlquiler=' + idAlquiler + "&tipoCuenta=" + tipoCuenta,
            async:false,
            success: function (result) {
                idInmueble = result.inmueble.idInmueble;
                item = "";
                var cont2 = 1;
                var cont = 1;
                item = item + "<div class='row'>";
                item = item + "<p><h3>Inmueble" + "<button class='btn btn-outline-secondary btn-sm' style='margin-left:900px;' onclick='Volver()'>Volver</button>" + "</h3></p>";
                item = item + "<div class='col-md-4'>";
                item = item + "<div id='carouselexamplecontrols" + cont.toString() + "' class='carousel slide' data-ride='carousel'>";
                item = item + "<div class='carousel-inner'>";
                $.each(result.inmueble.listaMultimedia, function (i, archivo) {
                    var ruta = archivo.url.split('\\')[archivo.url.split('\\').length - 1];
                    var activo = "";
                    if (cont2 == 1) {
                        var activo = "active";
                    }
                    item = item + "<div class='carousel-item " + activo + "'><img src='..\\TempFolder\\" + ruta + "' alt='' class='card-img-top' height='310' width='450'></div>";
                    cont2++;
                })
                item = item + "<a class='carousel-control-prev' href='#carouselexamplecontrols" + cont + "' role='button' data-slide='prev'>";
                item = item + "<span class='carousel-control-prev-icon' aria-hidden='true'></span>";
                item = item + "<span class='sr-only'>Previous</span></a>";
                //Boton prox imagen
                item = item + "<a class='carousel-control-next' href='#carouselexamplecontrols" + cont + "' role='button' data-slide='next'>";
                item = item + "<span class='carousel-control-next-icon' aria-hidden='true'></span>";
                item = item + "<span class='sr-only'>Next</span></a>";
                item = item + "</div></div></div>";
                item = item + "<div class='col-md-6'>"; //Aca van los datos del inmueble
                item = item + "<div class='card-body' style='padding-left:20;padding-top:0'><p class='card-title'>" + " " + result.inmueble.direccion.nombreCalle + " " + result.inmueble.direccion.numeroCalle + " - " + result.inmueble.direccion.localidad.nombreLocalidad + "</p>";
                item = item + "<h3><b>" + "Especificaciones: " + "</b></h3>";
                item = item + "<p><i class='fas fa-ruler-combined'></i>" + " " + result.inmueble.mtsCuadrados + " Metros Cuadrados." + "</p>";
                item = item + "<p><i class='fas fa-home'></i>" + " " + result.inmueble.mtsCuadradosInt + "  Metros Interior." + "</p>";
                item = item + "<p><i class='fas fa-bed'></i>" + " Cantidad de Habitaciones: " + result.inmueble.cantHabitaciones + "</p>";
                item = item + "<p><i class='fas fa-shower'></i>" + " Cantidad de Baños: " + result.inmueble.cantBanos + "</p>";
                if (result.inmueble.cochera) {
                    item = item + "<p><i class='fas fa-warehouse'></i>" + " " + "Tiene Cochera" + "</p>";
                } else {
                    item = item + "<p><i class='fas fa-warehouse'></i>" + "No tiene Cochera" + "</p>";
                }
                item = item + "</div>";
                item = item + "</div>";


                //Row Datos Arrendador u arrendatario (agregar condicion)
                if (tipoCuenta == 2) {

                    var ruta2 = result.arrendador.foto.split('\\')[result.arrendador.foto.split('\\').length - 1];
                    if (result.inmueble.tipoArrendador == 3) {
                        tipoCuentaAo = 3;
                        idAo = result.inmueble.idArrendador;
                        nombreArio = result.arrendador.nombrePropietario;
                        item = item + "<hr/>";
                        item = item + "<div class='row'>";
                        item = item + "<div class='row'>";
                        item = item + "<p><h3>Datos del Arrendador:</h3></p><img src='..\\TempFolder\\" + ruta2 + "' style='height:200px; width:220px; border-radius:100px;'></img></h3></p>";
                        item = item + "<span style='color:black;'><h4>Nombre: " + result.arrendador.nombrePropietario + ' ' + result.arrendador.apellidoPropietario + "</h4></span>";
                        item = item + "<span style='color:black;'><h4>Documento: " + result.arrendador.numeroDocumentoPropietario + "</h4></span>";
                        item = item + "<span style='color:black;'><h4>Telefono: " + result.arrendador.telefonoPropietario + "</h4></span>";
                        item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px; margin-left:11px; ' onclick='completarResenias2()'>Ver Reseñas Arrendador</button>";
                        item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px; ' onclick='completarReseniasInmueble2()'>Ver Reseñas Inmueble</button>";
                        item = item + "<div class='row' id='reseniasArAo'>";
                        item = item + "</div>";
                        item = item + "</div>";
                        //item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px;' onclick='completarReseniasInmueble2()'>Ver Reseñas Inmueble</button>";
                        //item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px;' onclick='completarResenias2()'>Ver Reseñas Arrendador</button>";
                        item = item + "</hr>";
                    } else {
                        tipoCuentaAo = 4;
                        idAo = result.inmueble.idArrendador;
                        nombreArio = result.arrendador.nombreInmobiliaria;
                        item = item + "<div class='row'>"
                        item = item + "<div class='row'>";
                        item = item + "<p><h3>Inmobiliaria</h3></p><img src='..\\TempFolder\\" + ruta2 + "' style='height:200px; width:220px; border-radius:100px;'></img></h3></p>";
                        item = item + "<span style='color:black;'><h4>Nombre: " + result.arrendador.nombreInmobiliaria + "</h4></span>";
                        item = item + "<span style='color:black;'><h4>Telefono: " + result.arrendador.telefonoInmobiliaria + "</h4></span>";
                        item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px; margin-left:11px;' onclick='completarResenias2()'>Ver Reseñas Inmobiliaria</button>";
                        item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px;' onclick='completarReseniasInmueble2()'>Ver Reseñas Inmueble</button>";
                        item = item + "<div class='row' id='reseniasArAo'>";
                        item = item + "</div>";
                        item = item + "</div>";
                        //item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px;' onclick='completarReseniasInmueble2()'>Ver Reseñas Inmueble</button>";
                        //item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px;' onclick='completarResenias2()'>Ver Reseñas Inmobiliaria</button>";
                        item = item + "</hr>";
                    }
                }
                if (tipoCuenta == 3 || tipoCuenta == 4) {
                    tipoCuentaAo = 2;
                    idAo = result.idArrendatario;
                    nombreArr = result.arrendatario.nombreArrendatario;
                    var ruta3 = result.arrendatario.foto.split('\\')[result.arrendatario.foto.split('\\').length - 1];
                    item = item + "<hr/>";
                    item = item + "<div class='row'>";
                    item = item + "<p><h3>Datos del Arrendatario:</h4></p><img src='..\\TempFolder\\" + ruta3 + "' style='height:200px; width:220px; border-radius:100px;></img></h3></p> ";
                    item = item + "<span style='color:black;'><h4><b>Nombre: </b>" + result.arrendatario.nombreArrendatario + " " + result.arrendatario.apellidoArrendatario + "</h4></span>";
                    item = item + "<span style='color:black;'><h4><b>Documento: </b>" + result.arrendatario.nroDocumento + "</h4></span>";
                    item = item + "<span style='color:black;'><h4><b>Telefono: </b>" + result.arrendatario.nroTelefono + "</h4></span>";
                    item = item + "<div class='row' id='reseniasAoAr'>";
                    item = item + "</div>";
                    item = item + "<button class='btn  btn-success' style = 'float:right; margin:5px; width:500px; margin-left:8px;' onclick='completarResenias2()'>Ver Reseñas Arrendatario</button>";
                }

                item = item + "</div>";

                //Row reseñas del inmueble
                if (tipoCuenta == 2) {
                    item = item + "<button type = 'button' class='btn btn-info btn-sm' style = 'float:right; margin:5px; width:500px;' onclick = 'mostrarformularioArrendador()'><i class='fas fa-plus'></i> Realizar nueva reseña Propietario</button >"
                    item = item + "<button type = 'button' class='btn btn-info btn-sm' style = 'float:right; margin:5px; width:500px;'  onclick = 'mostrarformularioInmueble()'><i class='fas fa-plus'></i> Realizar nueva reseña Inmueble</button >"
                }

                if (tipoCuenta == 3 || tipoCuenta == 4) {
                    item = item + "<br/><button type = 'button' class='btn btn-info btn-sm' style = 'float:right; margin:5px; width:500px;' onclick = 'mostrarformularioArrendatario()'><i class='fas fa-plus'></i> Realizar nueva reseña</button ><br/>"
                    item = item + " "
                }

                item = item + "<div id='mensajeError' style='display: none; font-size: 15px; background-color: #bf3131; width:500px; color: white; border-radius: 10px; justify-content: center; text-align:center; margin-left:auto; margin-right:auto;'>No puedes hacer una Reseña sobre un Alquiler que no se encuentra Activo</div>"

                if (tipoCuenta == 2) {
                    item = item + "<div class='row'>"
                    item = item + "<div class='row' id='reseniasAI' style='display:none'>";
                    item = item + "</div>";

                    item = item + "<div class='row' id='formularioAI' style='display:none'>";
                    item = item + "</div>";
                    cargarItemsAI();
                    item = item + "</div>";

                    item = item + "<div class='row' id='formularioArAo' style='display:none'>";
                    item = item + "</div>";
                    cargarItemsArAo();
                }
                if (tipoCuenta == 3 || tipoCuenta == 4) {

                    item = item + "<div class='row' id='formularioAoAr' style='display:none'>";
                    item = item + "</div>";
                    cargarItemsAoAr();
                }


                $("#Inmueble").append(item);
            }
        });
    }
    var listaItemsAoAr;
    var listaItemsAI;
    var listaItemsArAo;
    function cargarItemsAoAr() {
        //Haces el ajax
        $.ajax({
            type: 'Get',
            url: '/Api/Item/ListarItemsAoAr',
            success: function (result) {
                listaItemsAoAr = result;
                $("#formularioAoAr").append("<span style='margin-top:10px;'><h5>Items a Calificar:</h5></span>")
                result.forEach(function (data, index) {
                    $("#formularioAoAr").append("<div class='col-md-3'>" + data.nombreItemReseña);
                    var item1 = "<div class='rating'><input type ='radio' name ='rating" + data.idItemReseña + "' value ='5' id ='5" + data.idItemReseña + "'><label for='5" + data.idItemReseña + "'>☆</label><input type='radio' name='rating" + data.idItemReseña + "' value='4' id='4" + data.idItemReseña + "'><label for='4" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='3' id='3" + data.idItemReseña + "'><label for='3" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='2' id='2" + data.idItemReseña + "'><label for='2" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='1' id='1" + data.idItemReseña + "'><label for='1" + data.idItemReseña + "'>☆</label></div>"
                    item1 = item1 + "</div>";
                    $("#formularioAoAr").append(item1);
                });
                var item2 = "<div class='row'>";
                item2 = item2 + "<label>Descripción Reseña</label></br>"
                item2 = item2 + "<textarea class='form-control' id='descripcionAoAr' name='descripcionAoAr'></textarea>";
                item2 = item2 + "</div>";
                item2 = item2 + "<button class='btn btn-outline-success btn-sm' style='width:120px' onclick='GuardarReseñaAoAr()'>Guardar</button>";
                item2 = item2 + "<button class='btn btn-outline-danger btn-sm' id='btnvolverAoAr' onclick='volverAoAr()'  style='width:120px;'>Cancelar</button>"
                $("#formularioAoAr").append(item2)
            }
        });
    }
    function cargarItemsArAo() {
        //Haces el ajax
        $.ajax({
            type: 'Get',
            url: '/Api/Item/ListarItemsArAo',
            success: function (result) {
                listaItemsArAo = result;
                $("#formularioArAo").append("<span><h5>Items a Calificar:</h5></span>")
                result.forEach(function (data, index) {
                    $("#formularioArAo").append("<div class='col-md-3'>" + data.nombreItemReseña);
                    var item1 = "<div class='rating'><input type ='radio' name ='rating" + data.idItemReseña + "' value ='5' id ='5" + data.idItemReseña + "'><label for='5" + data.idItemReseña + "'>☆</label><input type='radio' name='rating" + data.idItemReseña + "' value='4' id='4" + data.idItemReseña + "'><label for='4" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='3' id='3" + data.idItemReseña + "'><label for='3" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='2' id='2" + data.idItemReseña + "'><label for='2" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='1' id='1" + data.idItemReseña + "'><label for='1" + data.idItemReseña + "'>☆</label></div>"
                    item1 = item1 + "</div>";
                    $("#formularioArAo").append(item1);
                });
                var item2 = "<div class='row'>";
                item2 = item2 + "<label>Descripción Reseña</label></br>"
                item2 = item2 + "<textarea class='form-control' id='descripcionArAo' name='descripcionArAo'></textarea>";
                item2 = item2 + "</div>";
                item2 = item2 + "<button class='btn btn-outline-success btn-sm' style='width:120px' onclick='GuardarReseñaArAo()'>Guardar</button>";
                item2 = item2 + "<button class='btn btn-outline-danger btn-sm' id='btnvolverArAo' onclick='volverArAo()' style='width:120px;'>Cancelar</button>"
                $("#formularioArAo").append(item2)
            }
        });
    }
    function cargarItemsAI() {
        //Haces el ajax
        $.ajax({
            type: 'Get',
            url: '/Api/Item/ListarItemsAI',
            success: function (result) {
                listaItemsAI = result;
                $("#formularioAI").append("<span><h5>Items a Calificar:</h5></span>")
                result.forEach(function (data, index) {
                    $("#formularioAI").append("<div class='col-md-3'>" + data.nombreItemReseña);
                    var item1 = "<div class='rating'><input type ='radio' name ='rating" + data.idItemReseña + "' value ='5' id ='5" + data.idItemReseña + "'><label for='5" + data.idItemReseña + "'>☆</label><input type='radio' name='rating" + data.idItemReseña + "' value='4' id='4" + data.idItemReseña + "'><label for='4" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='3' id='3" + data.idItemReseña + "'><label for='3" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='2' id='2" + data.idItemReseña + "'><label for='2" + data.idItemReseña + "'>☆</label> <input type='radio' name='rating" + data.idItemReseña + "' value='1' id='1" + data.idItemReseña + "'><label for='1" + data.idItemReseña + "'>☆</label></div>"
                    item1 = item1 + "</div>";
                    $("#formularioAI").append(item1);
                });
                var item2 = "<div class='row'>";
                item2 = item2 + "<label>Descripción Reseña</label></br>"
                item2 = item2 + "<textarea class='form-control' id='descripcionAI' name='descripcionAI'></textarea>";
                item2 = item2 + "</div>";
                item2 = item2 + "<button class='btn btn-outline-success btn-sm' style='width:120px' onclick='GuardarReseñaAI()'>Guardar</button>";
                item2 = item2 + "<button class='btn btn-outline-danger btn-sm' id='btnvolverAI' onclick='volverAI()' style='width:120px;;'>Cancelar</button>"
                $("#formularioAI").append(item2)
            }
        });
    }
    function volverArAo() {
        $("#formularioArAo").hide();
    }

    function volverAoAr() {
        $("#formularioAoAr").hide();
    }
    function volverAI() {
        $("#formularioAI").hide();
    }


    function GuardarReseñaAoAr() {
        if (verValorAoAr()) {
            var resenia = new Object();
            resenia.idAlquiler = idAlquiler;
            resenia.descripcionResenia = $("#descripcionAoAr").val();
            let listaReseniaItems = [];
            listaItemsAoAr.forEach(function (data, index) {
                var item = new Object();
                var stars = document.getElementsByTagName("input");
                for (var i = 0; i < stars.length; i++) {
                    if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                        if (stars[i].getAttribute('type') == 'radio') {
                            if ($("#" + stars[i].id).prop("checked")) {
                                item.puntuacionReseniaItem = $("#" + stars[i].id).prop("value");
                            }
                        }
                    }
                }
                item.idItemResenia = data.idItemReseña;
                listaReseniaItems.push(item);
            })
            resenia.listaReseniaItems = listaReseniaItems;
            $.ajax({
                type: 'Post',
                url: '/Api/Resenia/CrearReseniaAorAr',
                data: resenia,
                success: function (result) {
                    window.location.href = "/Alquileres/Alquiler?idAlquiler=" + idAlquiler;
                }
            });

        } else {
            $("#modalReseña").modal('show');
        }
    }
    function GuardarReseñaArAo() {
        if (verValorArAo()) {
            var resenia = new Object();
            resenia.idAlquiler = idAlquiler;
            resenia.descripcionResenia = $("#descripcionArAo").val();
            let listaReseniaItems = [];
            listaItemsArAo.forEach(function (data, index) {
                var item = new Object();
                var stars = document.getElementsByTagName("input");
                for (var i = 0; i < stars.length; i++) {
                    if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                        if (stars[i].getAttribute('type') == 'radio') {
                            if ($("#" + stars[i].id).prop("checked")) {
                                item.puntuacionReseniaItem = $("#" + stars[i].id).prop("value");
                            }
                        }
                    }
                }
                item.idItemResenia = data.idItemReseña;
                listaReseniaItems.push(item);
            })
            resenia.listaReseniaItems = listaReseniaItems;
            $.ajax({
                type: 'Post',
                url: '/Api/Resenia/CrearReseniaArAo',
                data: resenia,
                success: function (result) {
                    window.location.href = "/Alquileres/Alquiler?idAlquiler=" + idAlquiler;
                }
            });

        } else {
            $("#modalReseña").modal('show');
        }
    }
    function GuardarReseñaAI() {
        if (verValorAI()) {
            var resenia = new Object();
            resenia.idAlquiler = idAlquiler;
            resenia.descripcionResenia = $("#descripcionAI").val();
            let listaReseniaItems = [];
            listaItemsAI.forEach(function (data, index) {
                var item = new Object();
                var stars = document.getElementsByTagName("input");
                for (var i = 0; i < stars.length; i++) {
                    if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                        if (stars[i].getAttribute('type') == 'radio') {
                            if ($("#" + stars[i].id).prop("checked")) {
                                item.puntuacionReseniaItem = $("#" + stars[i].id).prop("value");
                            }
                        }
                    }
                }
                item.idItemResenia = data.idItemReseña;
                listaReseniaItems.push(item);
            })
            resenia.listaReseniaItems = listaReseniaItems;
            $.ajax({
                type: 'Post',
                url: '/Api/Resenia/CrearReseniaAI',
                data: resenia,
                success: function (result) {
                    window.location.href = "/Alquileres/Alquiler?idAlquiler=" + idAlquiler;
                }
            });

        } else {
            $("#modalReseña").modal('show');
        }
    }
    function verValorAoAr() {
        let bool = [];
        listaItemsAoAr.forEach(function (data, index) {
            var stars = document.getElementsByTagName("input");
            for (var i = 0; i < stars.length; i++) {
                if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                    if (stars[i].getAttribute('type') == 'radio') {
                        if ($("#" + stars[i].id).prop("checked")) {
                            console.log("Valor final del item " + data.nombreItemReseña + "=" + $("#" + stars[i].id).prop("value"))
                            bool.push(true);
                            break;
                        }
                    }
                }
            }
        });
        if (listaItemsAoAr.length == bool.length) {
            return true;
        } else {
            return false;
        }
    }
    function verValorArAo() {
        let bool = [];
        listaItemsArAo.forEach(function (data, index) {
            var stars = document.getElementsByTagName("input");
            for (var i = 0; i < stars.length; i++) {
                if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                    if (stars[i].getAttribute('type') == 'radio') {
                        if ($("#" + stars[i].id).prop("checked")) {
                            console.log("Valor final del item " + data.nombreItemReseña + "=" + $("#" + stars[i].id).prop("value"))
                            bool.push(true);
                            break;
                        }
                    }
                }
            }
        });
        if (listaItemsArAo.length == bool.length) {
            return true;
        } else {
            return false;
        }
    }
    function verValorAI() {
        let bool = [];
        listaItemsAI.forEach(function (data, index) {
            var stars = document.getElementsByTagName("input");
            for (var i = 0; i < stars.length; i++) {
                if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                    if (stars[i].getAttribute('type') == 'radio') {
                        if ($("#" + stars[i].id).prop("checked")) {
                            console.log("Valor final del item " + data.nombreItemReseña + "=" + $("#" + stars[i].id).prop("value"))
                            bool.push(true);
                            break;
                        }
                    }
                }
            }
        });
        if (listaItemsAI.length == bool.length) {
            return true;
        } else {
            return false;
        }
    }
    function verValorArAo() {
        let bool = [];
        listaItemsArAo.forEach(function (data, index) {
            var stars = document.getElementsByTagName("input");
            for (var i = 0; i < stars.length; i++) {
                if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                    if (stars[i].getAttribute('type') == 'radio') {
                        if ($("#" + stars[i].id).prop("checked")) {
                            console.log("Valor final del item " + data.nombreItemReseña + "=" + $("#" + stars[i].id).prop("value"))
                            bool.push(true);
                            break;
                        }
                    }
                }
            }
        });
        if (listaItemsArAo.length == bool.length) {
            return true;
        } else {
            return false;
        }
    }
    function verValorAI() {
        let bool = [];
        listaItemsAI.forEach(function (data, index) {
            var stars = document.getElementsByTagName("input");
            for (var i = 0; i < stars.length; i++) {
                if (stars[i].getAttribute('name') == 'rating' + data.idItemReseña) {
                    if (stars[i].getAttribute('type') == 'radio') {
                        if ($("#" + stars[i].id).prop("checked")) {
                            console.log("Valor final del item " + data.nombreItemReseña + "=" + $("#" + stars[i].id).prop("value"))
                            bool.push(true);
                            break;
                        }
                    }
                }
            }
        });
        if (listaItemsAI.length == bool.length) {
            return true;
        } else {
            return false;
        }
    }

    function completarResenias() {
        var tipoBusqueda = 1;
        $.ajax({
            type: 'Get',
            url: '/Api/Resenia/obtenerReseniasAlquiler?tipoCuenta=' + tipoCuenta + "&id=" + id + "&pag=" + pag + "&IdAlquiler=" + idAlquiler + "&tipoBusqueda=" + tipoBusqueda+"&fechaDesde=12/12/2012&fechaHasta=12/12/2012",
            success: function (result) {
                cantidad = result.cantidad;
                $("#body").empty();
                var item = "";
                if (tipoCuenta == 2) {
                    item = item + "<div><p><h3>Mis Reseñas sobre " + nombreArio + ":</h3></p></div>";
                }
                if (tipoCuenta == 3 || tipoCuenta == 4) {
                    item = item + "<p><h3> Mis Reseñas sobre " + nombreArr + ":</h3></p>";
                }
                result.lista.forEach(function (data, index) {
                    item = item + "<div class='row'>";
                    item = item + "<div class='col-md-2'>";
                    item = item + "<span>" + data.nombreAutor + "</span>";
                    item = item + "<span>" + data.fechaAltaReseña.toString().split('T')[0] + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-6'>";
                    item = item + "<span>" + data.descripcionResenia + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-2'style='text-align:center;'><span>Puntuación</span></br><span>" + data.puntuacionResenia + "</span></div>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-10' style='padding-left:0px;'>";
                    item = item + "<hr>";
                    item = item + "</div>";
                    item = item + "</div>";
                });


                $("#body").append(item);
                paginas();

            }
        });
    }
    function paginas() {
        var html = "<nav aria-label='...'>";
        html = html + "<ul class='pagination'>";
        var cantPag = 1;
        var resto = cantidad % 6;
        if (resto > 0) {
            cantPag = cantidad / 6 + 1;
        } else {
            cantPag = cantidad / 6;
        }

        for (var i = 1; i <= cantPag; i++) {
            if (i == pag) {
                html = html + "<li class='page-item active'><button class='page-link' id='pag" + i + "' onclick=cambiarPag(" + i + ")>" + i + "</button></li>";
            } else {
                html = html + "<li class='page-item'><button class='page-link' id='pag" + i + "' onclick=cambiarPag(" + i + ")>" + i + "</button></li>";
            }
        }
        html = html + "</ul>";
        html = html + "</nav>";
        $("#body").append(html);
    }
    function cambiarPag(num) {
        pag = num;
        completarResenias();
    }

    function completarReseniasInmueble() {
        var tipoBusqueda = 1;
        $.ajax({
            type: 'Get',
            url: '/Api/Resenia/obtenerReseniasAlquilerInmueble?tipoCuenta=' + tipoCuenta + "&id=" + id + "&pag=" + pag + "&IdAlquiler=" + idAlquiler + "&tipoBusqueda=" + tipoBusqueda,
            success: function (result) {
                cantidad = result.cantidad;
                $("#bodyInmueble").empty();
                var item = "";
                item = item + "<div><p><h3>Mis Reseñas sobre el Inmueble:</h3></p></div>";
                result.lista.forEach(function (data, index) {
                    item = item + "<div class='row'>";
                    item = item + "<div class='col-md-2'>";
                    item = item + "<span>" + data.nombreAutor + "</span>";
                    item = item + "<span>" + data.fechaAltaReseña.toString().split('T')[0] + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-6'>";
                    item = item + "<span>" + data.descripcionResenia + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-2'style='text-align:center;'><span>Puntuación</span></br><span>" + data.puntuacionResenia + "</span></div>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-10' style='padding-left:0px;'>";
                    item = item + "<hr>";
                    item = item + "</div>";
                    item = item + "</div>";
                });

                $("#bodyInmueble").append(item);
                paginasInmueble();
            }
        });
    }
    function paginasInmueble() {
        var html = "<nav aria-label='...'>";
        html = html + "<ul class='pagination'>";
        var cantPag = 1;
        var resto = cantidad % 6;
        if (resto > 0) {
            cantPag = cantidad / 6 + 1;
        } else {
            cantPag = cantidad / 6;
        }

        for (var i = 1; i <= cantPag; i++) {
            if (i == pag) {
                html = html + "<li class='page-item active'><button class='page-link' id='pag" + i + "' onclick=cambiarPagInmueble(" + i + ")>" + i + "</button></li>";
            } else {
                html = html + "<li class='page-item'><button class='page-link' id='pag" + i + "' onclick=cambiarPagInmueble(" + i + ")>" + i + "</button></li>";
            }
        }
        html = html + "</ul>";
        html = html + "</nav>";
        $("#bodyInmueble").append(html);
    }
    function cambiarPagInmueble(num) {
        pag = num;
        completarReseniasInmueble();
    }
    function mostrarformularioArrendador() {
        $.ajax({
            type: 'Get',
            url: '/Api/Resenia/indicadorAlquilerActivo?idAlquiler=' + idAlquiler,
            success: function (result) {
                if (result == 1) {
                    $("#formularioArAo").show();
                    $("#reseniasAI").hide();
                    $("#formularioAI").hide();
                } else {
                    $("#mensajeError").show();
                }
            }
        });
    }
    function mostrarformularioInmueble() {
        $.ajax({
            type: 'Get',
            url: '/Api/Resenia/indicadorAlquilerActivo?idAlquiler=' + idAlquiler,
            success: function (result) {
                if (result == 1) {
                    $("#reseniasAI").show();
                    $("#formularioAI").show();
                    $("#formularioArAo").hide();
                    $("#formulario2").hide();

                } else {
                    $("#mensajeError").show();
                }

            }
        });
    }

    function mostrarformularioArrendatario() {
        debugger;
        $.ajax({
            type: 'Get',
            url: '/Api/Resenia/indicadorAlquilerActivo?idAlquiler=' + idAlquiler,
            success: function (result) {
                if (result == 1) {
                    $("#formularioAoAr").show();

                } else {
                    $("#mensajeError").show();
                }
            }
        });
    }
    function Volver() {
        location.href = 'javascript: history.go(-1)';
    }

    function completarResenias2() {
        $("#modalarrendador").modal('show');

        var Hasta = new Date();
        var Desde = new Date(Hasta);
        var dias = 15;  //Dias para atras del dia de hoy para que salgan en Novedades
        Desde.setDate(Desde.getDate() - dias);
        var fechaDesdeInput = FechaformatoInput(Desde);
        var fechaHastaInput = FechaformatoInput(Hasta);

        //las cargo en las variables globales
        fechaDesde = fechaHoyMostrar(Desde);
        fechaHasta = fechaHoyMostrar(Hasta);
        //las cargo en el input
        $('#fechaDesdeFiltro').val(fechaDesdeInput);
        $('#fechaHastaFiltro').val(fechaHastaInput);
        obtres();
       
    }
    function obtres() {
        var tipoBusqueda = 2;
        $.ajax({
            type: 'Get',
            url: '/Api/Resenia/obtenerReseniasAlquiler?tipoCuenta=' + tipoCuenta + "&id=" + id + "&pag=" + pag + "&IdAlquiler=" + idAlquiler + "&tipoBusqueda=" + tipoBusqueda + "&fechaDesde=" + $('#fechaDesdeFiltro').val() + "&fechaHasta=" + $('#fechaHastaFiltro').val(),
            success: function (result) {
                cantidad = result.cantidad;
                $("#bodyModalArrendador").empty();
                var item = "";
                if (tipoCuenta == 2) {
                    item = item + "<div><p><h3>Reseñas sobre " + nombreArio + ":</h3></p></div>";
                }
                if (tipoCuenta == 3 || tipoCuenta == 4) {
                    item = item + "<p><h3>Reseñas sobre " + nombreArr + ":</h3></p>";
                }
                result.lista.forEach(function (data, index) {
                    item = item + "<div class='row'>";
                    item = item + "<div class='col-md-2'>";
                    item = item + "<span>" + data.nombreAutor + "</span>";
                    item = item + "<span>" + data.fechaAltaReseña.toString().split('T')[0] + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-6'>";
                    item = item + "<span>" + data.descripcionResenia + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-2'style='text-align:center;'><span>Puntuación</span></br><span>" + data.puntuacionResenia + "</span></div>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-10' style='padding-left:0px;'>";
                    item = item + "<hr>";
                    item = item + "</div>";
                    item = item + "</div>";
                });


                $("#bodyModalArrendador").append(item);
                paginas2();

            }
        });
    }
    function paginas2() {
        var html = "<nav aria-label='...'>";
        html = html + "<ul class='pagination'>";
        var cantPag = 1;
        var resto = cantidad % 6;
        if (resto > 0) {
            cantPag = cantidad / 6 + 1;
        } else {
            cantPag = cantidad / 6;
        }

        for (var i = 1; i <= cantPag; i++) {
            if (i == pag) {
                html = html + "<li class='page-item active'><button class='page-link' id='pag" + i + "' onclick=cambiarPag2(" + i + ")>" + i + "</button></li>";
            } else {
                html = html + "<li class='page-item'><button class='page-link' id='pag" + i + "' onclick=cambiarPag2(" + i + ")>" + i + "</button></li>";
            }
        }
        html = html + "</ul>";
        html = html + "</nav>";
        $("#bodyModalArrendador").append(html);
    }
    function cambiarPag2(num) {
        pag = num;
        completarResenias2();
    }
    function completarReseniasInmueble2() {
        $("#modalinmueble").modal('show');
        var tipoBusqueda = 2;
        $.ajax({
            type: 'Get',
            url: '/Api/Resenia/obtenerReseniasAlquilerInmueble?tipoCuenta=' + tipoCuenta + "&id=" + id + "&pag=" + pag + "&IdAlquiler=" + idAlquiler + "&tipoBusqueda=" + tipoBusqueda,
            success: function (result) {
                cantidad = result.cantidad;
                $("#bodyModalInmueble").empty();
                var item = "";
                item = item + "<div><p><h3>Reseñas sobre el Inmueble:</h3></p></div>";
                result.lista.forEach(function (data, index) {
                    item = item + "<div class='row'>";
                    item = item + "<div class='col-md-2'>";
                    item = item + "<span>" + data.nombreAutor + "</span>";
                    item = item + "<span>" + data.fechaAltaReseña.toString().split('T')[0] + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-6'>";
                    item = item + "<span>" + data.descripcionResenia + "</span></br>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-2'style='text-align:center;'><span>Puntuación</span></br><span>" + data.puntuacionResenia + "</span></div>";
                    item = item + "</div>";
                    item = item + "<div class='col-md-10' style='padding-left:0px;'>";
                    item = item + "<hr>";
                    item = item + "</div>";
                    item = item + "</div>";
                });

                $("#bodyModalInmueble").append(item);
                paginasInmueble2();
            }
        });
    }
    function paginasInmueble2() {
        var html = "<nav aria-label='...'>";
        html = html + "<ul class='pagination'>";
        var cantPag = 1;
        var resto = cantidad % 6;
        if (resto > 0) {
            cantPag = cantidad / 6 + 1;
        } else {
            cantPag = cantidad / 6;
        }

        for (var i = 1; i <= cantPag; i++) {
            if (i == pag) {
                html = html + "<li class='page-item active'><button class='page-link' id='pag" + i + "' onclick=cambiarPagInmueble2(" + i + ")>" + i + "</button></li>";
            } else {
                html = html + "<li class='page-item'><button class='page-link' id='pag" + i + "' onclick=cambiarPagInmueble2(" + i + ")>" + i + "</button></li>";
            }
        }
        html = html + "</ul>";
        html = html + "</nav>";
        $("#bodyModalInmueble").append(html);
    }
    function cambiarPagInmueble2(num) {
        pag = num;
        completarReseniasInmueble2();
    }
</script>
@* MODALES *@
<div class="modal fade" id="modalReseña" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel" style="color: #c51616"><b>Valorar Items</b></h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Por favor ingrese una calificación para cada uno de los items a valorar.
            </div>
            <div class="modal-footer">
                <a href="" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Aceptar</a>
            </div>
        </div>
    </div>
</div>